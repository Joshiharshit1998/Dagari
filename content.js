(()=>{function e(e){let t="";try{"undefined"!=typeof chrome&&chrome.runtime&&chrome.runtime.getURL?t=chrome.runtime.getURL(e):"undefined"!=typeof browser&&browser.runtime&&browser.runtime.getURL?t=browser.runtime.getURL(e):(console.warn("[Sokuji] [Content] Browser extension API not available, using relative path"),t=e)}catch(n){console.error("[Sokuji] [Content] Error getting extension URL:",n),t=e}return t}function t(){const t=document.getElementById("sokujiPermissionsIFrame");t&&t.remove();const n=document.createElement("iframe");if(n.hidden=!0,n.id="sokujiPermissionsIFrame",n.allow="microphone",n.src=e("permission.html"),setTimeout((()=>{n&&n.parentNode&&n.parentNode.removeChild(n)}),5e3),document.body)document.body.appendChild(n);else{if(!document.documentElement)return void console.error("[Sokuji] [Content] Cannot inject permission iframe - no suitable parent element found");document.documentElement.appendChild(n)}console.info("[Sokuji] [Content] Permission iframe injected into page")}!function(){const t=e("content/device-emulator.iife.js"),n=document.createElement("script");n.src=t,n.async=!1,n.id="sokuji-device-emulator-script",document.head?document.head.insertBefore(n,document.head.firstChild):document.documentElement?document.documentElement.insertBefore(n,document.documentElement.firstChild):document.appendChild(n),console.info("[Sokuji] [Content] Device emulator script injected into page")}(),function(){const t=e("content/virtual-microphone.js"),n=document.createElement("script");n.src=t,n.async=!1,n.id="sokuji-virtual-microphone-script",document.head?document.head.insertBefore(n,document.head.firstChild):document.documentElement?document.documentElement.insertBefore(n,document.documentElement.firstChild):document.appendChild(n),console.info("[Sokuji] [Content] Virtual microphone script injected into page")}(),function(){const t=window.location.hostname;let n,o;"app.gather.town"===t?(n=chrome.i18n.getMessage("gatherTownTitle"),o=chrome.i18n.getMessage("gatherTownGuidance")):"whereby.com"===t?(n=chrome.i18n.getMessage("wherebyTitle"),o=chrome.i18n.getMessage("wherebyGuidance")):"discord.com"===t?(n=chrome.i18n.getMessage("discordTitle"),o=chrome.i18n.getMessage("discordGuidance")):"app.slack.com"===t?(n=chrome.i18n.getMessage("slackTitle"),o=chrome.i18n.getMessage("slackGuidance")):(n=chrome.i18n.getMessage("defaultTitle"),o=chrome.i18n.getMessage("defaultGuidance"));const i={title:n,guidance:o,gotIt:chrome.i18n.getMessage("gotIt"),remindLater:chrome.i18n.getMessage("remindLater")},c=new URLSearchParams;for(const[e,t]of Object.entries(i))if(t)try{const n=btoa(unescape(encodeURIComponent(t)));c.set(e,n)}catch(n){console.warn(`[Sokuji] [Content] Failed to encode i18n message for ${e}:`,n),c.set(e,encodeURIComponent(t))}const r=`${e("content/site-plugins.js")}?${c.toString()}`,s=document.createElement("script");s.src=r,s.async=!1,s.id="sokuji-site-plugins-script",document.head?document.head.appendChild(s):document.documentElement?document.documentElement.appendChild(s):document.appendChild(s),console.info("[Sokuji] [Content] Site plugins script injected into page with i18n parameters (Base64 encoded)")}(),"complete"===document.readyState||"interactive"===document.readyState?t():document.addEventListener("DOMContentLoaded",t),chrome.runtime.onMessage.addListener(((e,t,n)=>"PCM_DATA"===e.type&&(console.debug(`[Sokuji] [Content] Received PCM data from side panel script: chunk ${e.chunkIndex+1}/${e.totalChunks}`),window.postMessage(e,"*"),n&&n({success:!0}),!0))),console.info("[Sokuji] [Content] Universal content script loaded and ready for audio bridging"),window.sokujiContentScript={version:"2.0.0",context:"content",getStatus:()=>({initialized:!0,context:"content",canInjectScripts:!0,permissionIframeInjected:!!document.getElementById("sokujiPermissionsIFrame"),deviceEmulatorScriptInjected:!!document.getElementById("sokuji-device-emulator-script"),virtualMicScriptInjected:!!document.getElementById("sokuji-virtual-microphone-script"),pluginsScriptInjected:!!document.getElementById("sokuji-site-plugins-script")}),getPageContextStatus:()=>{try{const e=window.wrappedJSObject?window.wrappedJSObject.sokujiPageContext:null;return e?e.getStatus():{error:"Page context not accessible from content script"}}catch(e){return{error:"Cannot access page context: "+e.message}}}}})();