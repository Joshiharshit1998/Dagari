!function(){"use strict";MediaStreamTrack.prototype.getCapabilities=MediaStreamTrack.prototype.getCapabilities||function(){return{}};const e=HTMLAudioElement.prototype.setSinkId;HTMLAudioElement.prototype.setSinkId=class{async setSinkId(t){const r=navigator.mediaDevices.meta?.[t];"audiooutput"!==r?.device.kind?await e.call(this,t):this.sinkId=t}}.prototype.setSinkId;var t=function(e){return function(e){return!!e&&"object"==typeof e}(e)&&!function(e){var t=Object.prototype.toString.call(e);return"[object RegExp]"===t||"[object Date]"===t||function(e){return e.$$typeof===r}(e)}(e)},r="function"==typeof Symbol&&Symbol.for?Symbol.for("react.element"):60103;function i(e,t){return!1!==t.clone&&t.isMergeableObject(e)?s((r=e,Array.isArray(r)?[]:{}),e,t):e;var r}function n(e,t,r){return e.concat(t).map((function(e){return i(e,r)}))}function o(e){return Object.keys(e).concat(function(e){return Object.getOwnPropertySymbols?Object.getOwnPropertySymbols(e).filter((function(t){return e.propertyIsEnumerable(t)})):[]}(e))}function a(e,t){try{return t in e}catch(e){return!1}}function s(e,r,c){(c=c||{}).arrayMerge=c.arrayMerge||n,c.isMergeableObject=c.isMergeableObject||t,c.cloneUnlessOtherwiseSpecified=i;var d=Array.isArray(r);return d===Array.isArray(e)?d?c.arrayMerge(e,r,c):function(e,t,r){var n={};return r.isMergeableObject(e)&&o(e).forEach((function(t){n[t]=i(e[t],r)})),o(t).forEach((function(o){(function(e,t){return a(e,t)&&!(Object.hasOwnProperty.call(e,t)&&Object.propertyIsEnumerable.call(e,t))})(e,o)||(a(e,o)&&r.isMergeableObject(t[o])?n[o]=function(e,t){if(!t.customMerge)return s;var r=t.customMerge(e);return"function"==typeof r?r:s}(o,r)(e[o],t[o],r):n[o]=i(t[o],r))})),n}(e,r,c):i(r,c)}s.all=function(e,t){if(!Array.isArray(e))throw new Error("first argument should be an array");return e.reduce((function(e,r){return s(e,r,t)}),{})};var c=s;function d(e,t){const r=e[t]?.exact,i=e[t]?.ideal,n=e[t];return r??i??n}function u(e,t){const r=r=>{if(!e[r])return null;if(Array.isArray(e[r])){const i=e[r].findIndex((e=>e.sourceId));if(-1===i)return null;const n=e[r][i],{sourceId:o}=n;return t&&(1===Object.keys(n).length?t[r]=e[r].splice(i,1):(t[r]=[{sourceId:n.sourceId}],delete n.sourceId)),o}const i=e[r],{sourceId:n}=i;return n?(t&&(t[r]={sourceId:i.sourceId},delete i.sourceId),n):null},i=r("mandatory");if(i)return i;const n=r("optional");if(n)return n;const o=d(e,"deviceId");return t&&(t.deviceId=e.deviceId,delete e.deviceId),o}function l(e,t,r,i){const n=e[r];if(!n)return null;const o=u(n);if(!o)return null;const a=i[o];if(a?.device.kind!==`${r}input`)return null;if(a.fail)throw new TypeError(`NotReadableError: Failed to allocate ${r}source`);return t[r]=e[r],delete e[r],o}function p(e){const t=new AudioContext,r=new OscillatorNode(t),i=new GainNode(t,{gain:+!e.silent}),n=new MediaStreamAudioDestinationNode(t);return r.connect(i),i.connect(n),r.start(),e.eventTarget.addEventListener("toggleSilence",(()=>{i.gain.value=+!e.silent})),n.stream}const m=void 0===Number.MAX_SAFE_INTEGER?9007199254740991:Number.MAX_SAFE_INTEGER,f=1073741824,v=new WeakMap;var g;const h=((e,t)=>r=>{const i=t.get(r);let n=void 0===i?r.size:i<f?i+1:0;if(!r.has(n))return e(r,n);if(r.size<536870912){for(;r.has(n);)n=Math.floor(Math.random()*f);return e(r,n)}if(r.size>m)throw new Error("Congratulations, you created a collection of unique numbers which uses all available integers!");for(;r.has(n);)n=Math.floor(Math.random()*m);return e(r,n)})((g=v,(e,t)=>(g.set(e,t),t)),v),y=(()=>{let e=null;return()=>{if(null!==e)return e;const t=new Blob(['(()=>{"use strict";const e=new Map,t=new Map,r=(e,t)=>{let r,o;const i=performance.now();r=i,o=e-Math.max(0,i-t);return{expected:r+o,remainingDelay:o}},o=(e,t,r,i)=>{const s=performance.now();s>r?postMessage({id:null,method:"call",params:{timerId:t,timerType:i}}):e.set(t,setTimeout(o,r-s,e,t,r,i))};addEventListener("message",(i=>{let{data:s}=i;try{if("clear"===s.method){const{id:r,params:{timerId:o,timerType:i}}=s;if("interval"===i)(t=>{const r=e.get(t);if(void 0===r)throw new Error(\'There is no interval scheduled with the given id "\'.concat(t,\'".\'));clearTimeout(r),e.delete(t)})(o),postMessage({error:null,id:r});else{if("timeout"!==i)throw new Error(\'The given type "\'.concat(i,\'" is not supported\'));(e=>{const r=t.get(e);if(void 0===r)throw new Error(\'There is no timeout scheduled with the given id "\'.concat(e,\'".\'));clearTimeout(r),t.delete(e)})(o),postMessage({error:null,id:r})}}else{if("set"!==s.method)throw new Error(\'The given method "\'.concat(s.method,\'" is not supported\'));{const{params:{delay:i,now:n,timerId:a,timerType:d}}=s;if("interval"===d)((t,i,s)=>{const{expected:n,remainingDelay:a}=r(t,s);e.set(i,setTimeout(o,a,e,i,n,"interval"))})(i,a,n);else{if("timeout"!==d)throw new Error(\'The given type "\'.concat(d,\'" is not supported\'));((e,i,s)=>{const{expected:n,remainingDelay:a}=r(e,s);t.set(i,setTimeout(o,a,t,i,n,"timeout"))})(i,a,n)}}}}catch(e){postMessage({error:{message:e.message},id:s.id,result:null})}}))})();'],{type:"application/javascript; charset=utf-8"}),r=URL.createObjectURL(t);return e=(e=>{const t=new Map([[0,()=>{}]]),r=new Map([[0,()=>{}]]),i=new Map,n=new Worker(e);return n.addEventListener("message",(e=>{let{data:n}=e;if(void 0!==(o=n).method&&"call"===o.method){const{params:{timerId:e,timerType:o}}=n;if("interval"===o){const r=t.get(e);if("number"==typeof r){const t=i.get(r);if(void 0===t||t.timerId!==e||t.timerType!==o)throw new Error("The timer is in an undefined state.")}else{if(void 0===r)throw new Error("The timer is in an undefined state.");r()}}else if("timeout"===o){const t=r.get(e);if("number"==typeof t){const r=i.get(t);if(void 0===r||r.timerId!==e||r.timerType!==o)throw new Error("The timer is in an undefined state.")}else{if(void 0===t)throw new Error("The timer is in an undefined state.");t(),r.delete(e)}}}else{if(!(e=>null===e.error&&"number"==typeof e.id)(n)){const{error:{message:e}}=n;throw new Error(e)}{const{id:e}=n,o=i.get(e);if(void 0===o)throw new Error("The timer is in an undefined state.");const{timerId:a,timerType:s}=o;i.delete(e),"interval"===s?t.delete(a):r.delete(a)}}var o})),{clearInterval:e=>{const r=h(i);i.set(r,{timerId:e,timerType:"interval"}),t.set(e,r),n.postMessage({id:r,method:"clear",params:{timerId:e,timerType:"interval"}})},clearTimeout:e=>{const t=h(i);i.set(t,{timerId:e,timerType:"timeout"}),r.set(e,t),n.postMessage({id:t,method:"clear",params:{timerId:e,timerType:"timeout"}})},setInterval:(e,r)=>{const i=h(t);return t.set(i,(()=>{e(),"function"==typeof t.get(i)&&n.postMessage({id:null,method:"set",params:{delay:r,now:performance.now(),timerId:i,timerType:"interval"}})})),n.postMessage({id:null,method:"set",params:{delay:r,now:performance.now(),timerId:i,timerType:"interval"}}),i},setTimeout:(e,t)=>{const i=h(r);return r.set(i,e),n.postMessage({id:null,method:"set",params:{delay:t,now:performance.now(),timerId:i,timerType:"timeout"}}),i}}})(r),setTimeout((()=>URL.revokeObjectURL(r))),e}})();function w(e){const t=document.createElement("canvas"),r=(new Date).getTime(),i=e.device.getCapabilities();t.width=i.width?.max??640,t.height=i.height?.max??480;const n=t.getContext("2d");if(!n)throw new TypeError("UnknownError: an unknown error occurred");var o;return o=()=>{if(e.silent)n.fillStyle="red",n.fillRect(0,0,t.width,t.height);else{n.fillStyle="green",n.fillRect(0,0,t.width,t.height),n.font="50px Arial",n.fillStyle="blue",n.textAlign="center";let e=(new Date).getTime()-r;e/=100,e=Math.floor(e+1e3),n.fillText(e.toString(),t.width/2,t.height/2)}},y().setInterval(o,100),t.captureStream(i.frameRate?.max)}function M(e,t,r){const i=r.device.getCapabilities().facingMode,n=d(e,"facingMode");n&&i?.includes(n)&&(t.facingMode=e.facingMode,delete e.facingMode)}function E(e,t,r){d(e,"groupId")===r.device.groupId&&(t.groupId=e.groupId,delete e.groupId)}function I(e){const t=e.getTracks();if(1!==t.length)throw new TypeError("UnknownError: an unknown error occurred");return t[0]}async function b(e,t,r,i,n){const o=r[i],a=n[e],s=I(("audio"===i?p:w)(a)),l=a.device.getCapabilities().facingMode;let m={};u(o,m),M(o,m,a),E(o,m,a);const f=s.getConstraints(),v=c(f,o);try{await s.applyConstraints(v)}catch(e){console.error(`DyteDeviceEmulator:: track.applyConstraints failed for ${JSON.stringify(v)}`,e)}const g=s.getConstraints.bind(s),h=s.getSettings.bind(s),y=s.getCapabilities.bind(s),b=s.applyConstraints.bind(s);s.getConstraints=()=>c(g(),m),s.getSettings=()=>{const t=d(m,"facingMode"),r=l?.[0];return{...h(),deviceId:e,groupId:a.device.groupId,facingMode:t??r}},s.getCapabilities=()=>({...y(),deviceId:e,facingMode:l,groupId:a.device.groupId}),s.applyConstraints=async t=>{const r={};if(!t)return await b(t),void(m=r);u(t)===e&&u(t,m),M(t,r,a),E(t,r,a),await b(t),m=r},a.tracks.push(s),t.addTrack(s)}async function T(e,t,r){const i={},n=l(t,i,"audio",r),o=l(t,i,"video",r);if(0===Object.keys(i).length)return await e(t);const a=n?r[n]:null,s=o?r[o]:null,c=a?.customStream,d=s?.customStream;if(c||d){let u;if(c&&d){u=new MediaStream;const e=a.customStream.getAudioTracks(),t=s.customStream.getVideoTracks();e.forEach((e=>u.addTrack(e))),t.forEach((e=>u.addTrack(e)))}else c?(u=a.customStream.clone(),o&&await b(o,u,i,"video",r)):(u=s.customStream.clone(),n&&await b(n,u,i,"audio",r));return(t.audio||t.video)&&(await e(t)).getTracks().forEach((e=>{u.addTrack(e)})),u}const u=new MediaStream;return n&&await b(n,u,i,"audio",r),o&&await b(o,u,i,"video",r),(t.audio||t.video)&&(await e(t)).getTracks().forEach((e=>{u.addTrack(e)})),u}const D=MediaDevices.prototype.enumerateDevices,k=MediaDevices.prototype.getDisplayMedia,S=MediaDevices.prototype.getUserMedia;class O{async enumerateDevices(){const e=await D.call(this);return this.meta?Object.keys(this.meta).map((e=>this.meta[e].device)).concat(e):e}async getDisplayMedia(e){const t=k.bind(this);return e&&this.meta?(e.video||(e.video=!0),await T(t,e,this.meta)):await t(e)}async getUserMedia(e){const t=S.bind(this);return e&&this.meta?await T(t,e,this.meta):await t(e)}addEmulatedDevice(e,t,r){const i=r?.deviceId||crypto.randomUUID(),n=r?.label||`Emulated device of ${e} kind - ${i}`,o=r?.groupId||"emulated-device-group",a=r?.stream;if(this.meta&&this.meta[i])throw new Error(`Device with deviceId "${i}" already exists`);const s={deviceId:i,kind:e,label:n,groupId:o,toJSON:()=>s};if("audioinput"===e||"videoinput"===e){"undefined"!=typeof InputDeviceInfo&&Object.setPrototypeOf(s,InputDeviceInfo.prototype);const r="audioinput"===e?this.emulatedAudioDeviceCapabilities:this.emulatedVideoDeviceCapabilities,i=t?c(r,t):r;s.getCapabilities=()=>({...i,deviceId:s.deviceId,groupId:s.groupId})}else Object.setPrototypeOf(s,MediaDeviceInfo.prototype);let d=[];a&&("videoinput"===e?d=a.getVideoTracks():"audioinput"===e&&(d=a.getAudioTracks()));const u={tracks:d,fail:!1,silent:!1,device:s,eventTarget:new EventTarget,customStream:a};return this.meta?this.meta[s.deviceId]=u:this.meta={[s.deviceId]:u},this.dispatchEvent(new Event("devicechange")),i}failDevice(e,t){const r=this.meta?.[e];return!!r&&(r.tracks.forEach((e=>{e.stop(),e.dispatchEvent(new Event("ended"))})),r.fail=t,r.tracks.length=0,this.meta&&(this.meta[e]=r),!0)}removeEmulatedDevice(e){const t=this.meta?.[e];return!!t&&(t.tracks.forEach((e=>{e.stop(),e.dispatchEvent(new Event("ended"))})),delete this.meta[e],this.dispatchEvent(new Event("devicechange")),!0)}silenceDevice(e,t){const r=this.meta?.[e];return!!r&&(r.silent=t,r.eventTarget.dispatchEvent(new Event("toggleSilence")),!0)}}MediaDevices.prototype.enumerateDevices=O.prototype.enumerateDevices,MediaDevices.prototype.getDisplayMedia=O.prototype.getDisplayMedia,MediaDevices.prototype.getUserMedia=O.prototype.getUserMedia,MediaDevices.prototype.addEmulatedDevice=O.prototype.addEmulatedDevice,MediaDevices.prototype.failDevice=O.prototype.failDevice,MediaDevices.prototype.removeEmulatedDevice=O.prototype.removeEmulatedDevice,MediaDevices.prototype.silenceDevice=O.prototype.silenceDevice,MediaDevices.prototype.emulatedAudioDeviceCapabilities=function(){const e=new AudioContext,{stream:t}=new MediaStreamAudioDestinationNode(e),r=I(t),i=r.getCapabilities();return r.stop(),i}(),MediaDevices.prototype.emulatedVideoDeviceCapabilities=function(){const e=document.createElement("canvas");if(!e.getContext("2d"))throw new TypeError("UnknownError: an unknown error occurred");const t=I(e.captureStream()),r=t.getCapabilities();return t.stop(),r}(),window.dispatchEvent(new Event("dyte.deviceEmulatorLoaded"))}();