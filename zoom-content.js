(()=>{function e(e){let o="";try{"undefined"!=typeof chrome&&chrome.runtime&&chrome.runtime.getURL?o=chrome.runtime.getURL(e):"undefined"!=typeof browser&&browser.runtime&&browser.runtime.getURL?o=browser.runtime.getURL(e):(console.warn("[Sokuji] [Zoom] Browser extension API not available, using relative path"),o=e)}catch(t){console.error("[Sokuji] [Zoom] Error getting extension URL:",t),o=e}return o}const o=window!==window.top&&window.self.frameElement&&"webclient"===window.self.frameElement.id;if(console.info(`[Sokuji] [Zoom] Initializing: isWebclientIframe=${o}`),o){function t(){function e(){const e=document.querySelector(".audio-option-menu__pop-menu");if(!e)return;const o=Array.from(e.querySelectorAll(".dropdown-header")).find((e=>e.textContent.includes("Select a Microphone")));if(!o)return;const t=[];let n=o.nextElementSibling;for(;n&&!n.classList.contains("common-ui-component__dropdown-divider");)n.classList.contains("dropdown-item")&&n.getAttribute("aria-label")?.includes("Select a microphone")&&t.push(n),n=n.nextElementSibling;const i=t.some((e=>e.classList.contains("audio-option-menu__pop-menu--checked"))),r=t.find((e=>e.textContent.includes("Sokuji Virtual Microphone")));if(!i&&r)console.info("[Sokuji] [Zoom] No microphone selected, auto-selecting Sokuji Virtual Microphone"),t.forEach((e=>{e.classList.remove("audio-option-menu__pop-menu--checked"),e.setAttribute("aria-selected","false"),e.setAttribute("aria-label",e.getAttribute("aria-label")?.replace(" selected"," unselect")||"")})),r.classList.add("audio-option-menu__pop-menu--checked"),r.setAttribute("aria-selected","true"),r.setAttribute("aria-label",r.getAttribute("aria-label")?.replace(" unselect"," selected")||"");else if(i&&r){const e=r.classList.contains("audio-option-menu__pop-menu--checked"),o=t.some((e=>e!==r&&e.classList.contains("audio-option-menu__pop-menu--checked")));e&&o&&(console.info("[Sokuji] [Zoom] Another microphone is selected, unchecking Sokuji Virtual Microphone"),r.classList.remove("audio-option-menu__pop-menu--checked"),r.setAttribute("aria-selected","false"),r.setAttribute("aria-label",r.getAttribute("aria-label")?.replace(" selected"," unselect")||""))}}new MutationObserver((o=>{o.forEach((o=>{"childList"===o.type&&o.addedNodes.forEach((o=>{o.nodeType===Node.ELEMENT_NODE&&(o.classList?.contains("audio-option-menu__pop-menu")||o.querySelector?.(".audio-option-menu__pop-menu"))&&setTimeout(e,100)})),"attributes"===o.type&&o.target.classList?.contains("audio-option-menu__pop-menu")&&setTimeout(e,100)}))})).observe(document.documentElement,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["class","style"]}),setInterval(e,2e3),console.info("[Sokuji] [Zoom] Microphone selection monitor initialized")}function n(){const o=document.getElementById("sokujiPermissionsIFrame");o&&o.remove();const t=document.createElement("iframe");if(t.hidden=!0,t.id="sokujiPermissionsIFrame",t.allow="microphone",t.src=e("permission.html"),setTimeout((()=>{t&&t.parentNode&&t.parentNode.removeChild(t)}),5e3),document.body)document.body.appendChild(t);else{if(!document.documentElement)return void console.error("[Sokuji] [Zoom] Cannot inject permission iframe - no suitable parent element found");document.documentElement.appendChild(t)}console.info("[Sokuji] [Zoom] Permission iframe injected into page")}function i(){if(document.getElementById("sokuji-zoom-audio-profile-notification"))return;const e=document.createElement("div");e.id="sokuji-zoom-audio-profile-notification",e.style.cssText="\n      position: fixed;\n      top: 20px;\n      right: 20px;\n      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n      color: white;\n      padding: 16px 20px;\n      border-radius: 8px;\n      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);\n      z-index: 10000;\n      max-width: 350px;\n      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n      font-size: 14px;\n      line-height: 1.4;\n      border: 1px solid rgba(255, 255, 255, 0.2);\n    ",e.innerHTML='\n      <div style="display: flex; align-items: flex-start; gap: 12px;">\n        <div style="flex-shrink: 0; margin-top: 2px;">\n          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n            <path d="M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126zM12 15.75h.007v.008H12v-.008z"/>\n          </svg>\n        </div>\n        <div style="flex: 1;">\n          <div style="font-weight: 600; margin-bottom: 8px; color: #fff;">\n            Sokuji Audio Settings Recommendation\n          </div>\n          <div style="margin-bottom: 12px; color: rgba(255, 255, 255, 0.9);">\n            For optimal audio quality, please set <strong>Background noise suppression</strong> to <strong>"Browser built-in noise suppression"</strong> in your Audio Profile settings. This prevents audio stuttering and ensures smooth transmission.\n          </div>\n          <div style="display: flex; gap: 8px; align-items: center;">\n            <button id="sokuji-zoom-audio-profile-dismiss" style="\n              background: rgba(255, 255, 255, 0.2);\n              border: 1px solid rgba(255, 255, 255, 0.3);\n              color: white;\n              padding: 6px 12px;\n              border-radius: 4px;\n              font-size: 12px;\n              cursor: pointer;\n              transition: all 0.2s ease;\n            ">\n              Got it\n            </button>\n            <button id="sokuji-zoom-audio-profile-remind-later" style="\n              background: transparent;\n              border: none;\n              color: rgba(255, 255, 255, 0.7);\n              padding: 6px 8px;\n              font-size: 12px;\n              cursor: pointer;\n              text-decoration: underline;\n              transition: color 0.2s ease;\n            ">\n              Remind me later\n            </button>\n          </div>\n        </div>\n      </div>\n    ';const o=e.querySelector("#sokuji-zoom-audio-profile-dismiss"),t=e.querySelector("#sokuji-zoom-audio-profile-remind-later");o&&(o.addEventListener("click",(()=>{e.remove();try{localStorage.setItem("sokuji-zoom-audio-profile-dismissed","true")}catch(e){console.warn("[Sokuji] [Zoom] Could not store dismissal state:",e)}})),o.addEventListener("mouseenter",(()=>{o.style.background="rgba(255, 255, 255, 0.3)"})),o.addEventListener("mouseleave",(()=>{o.style.background="rgba(255, 255, 255, 0.2)"}))),t&&(t.addEventListener("click",(()=>{e.remove(),setTimeout((()=>{i()}),6e5)})),t.addEventListener("mouseenter",(()=>{t.style.color="rgba(255, 255, 255, 1)"})),t.addEventListener("mouseleave",(()=>{t.style.color="rgba(255, 255, 255, 0.7)"})));const n=setTimeout((()=>{e&&e.parentNode&&e.remove()}),3e4);if(e.addEventListener("click",(()=>{clearTimeout(n)})),document.body)document.body.appendChild(e);else{if(!document.documentElement)return void console.error("[Sokuji] [Zoom] Cannot show audio profile notification - no suitable parent element found");document.documentElement.appendChild(e)}console.info("[Sokuji] [Zoom] Audio profile notification shown")}!function(){const o=e("content/device-emulator.iife.js"),t=document.createElement("script");t.src=o,t.async=!1,t.id="sokuji-device-emulator-script",document.head?document.head.insertBefore(t,document.head.firstChild):document.documentElement?document.documentElement.insertBefore(t,document.documentElement.firstChild):document.appendChild(t),console.info("[Sokuji] [Zoom] Device emulator script injected into Zoom webclient iframe")}(),function(){const o=e("content/virtual-microphone.js"),t=document.createElement("script");t.src=o,t.async=!1,t.id="sokuji-virtual-microphone-script",document.head?document.head.insertBefore(t,document.head.firstChild):document.documentElement?document.documentElement.insertBefore(t,document.documentElement.firstChild):document.appendChild(t),console.info("[Sokuji] [Zoom] Virtual microphone script injected into Zoom webclient iframe")}(),"complete"===document.readyState||"interactive"===document.readyState?(n(),t(),setTimeout((()=>{try{localStorage.getItem("sokuji-zoom-audio-profile-dismissed")||i()}catch(e){i()}}),3e3)):document.addEventListener("DOMContentLoaded",(()=>{n(),t(),setTimeout((()=>{try{localStorage.getItem("sokuji-zoom-audio-profile-dismissed")||i()}catch(e){i()}}),3e3)})),chrome.runtime.onMessage.addListener(((e,o,t)=>"PCM_DATA"===e.type&&(console.debug(`[Sokuji] [Zoom] Received PCM data from side panel script: chunk ${e.chunkIndex+1}/${e.totalChunks}`),window.postMessage(e,"*"),t&&t({success:!0}),!0))),console.info("[Sokuji] [Zoom] Zoom-specific content script loaded and ready for audio bridging"),window.sokujiZoomContent={version:"1.0.0",getStatus:()=>({initialized:!0,isWebclientIframe:o,hasVirtualMic:!!window.sokujiVirtualMic,canInjectAudio:!0,microphoneMonitorActive:!0,deviceEmulatorScriptInjected:!!document.getElementById("sokuji-device-emulator-script"),virtualMicScriptInjected:!!document.getElementById("sokuji-virtual-microphone-script"),audioProfileNotificationDismissed:(()=>{try{return"true"===localStorage.getItem("sokuji-zoom-audio-profile-dismissed")}catch(e){return!1}})()}),checkMicrophoneSelection:()=>{const e=document.querySelector(".audio-option-menu__pop-menu");if(!e)return{status:"menu_not_visible"};const o=Array.from(e.querySelectorAll(".dropdown-header")).find((e=>e.textContent.includes("Select a Microphone")));if(!o)return{status:"microphone_section_not_found"};const t=[];let n=o.nextElementSibling;for(;n&&!n.classList.contains("common-ui-component__dropdown-divider");)n.classList.contains("dropdown-item")&&n.getAttribute("aria-label")?.includes("Select a microphone")&&t.push({text:n.textContent,selected:n.classList.contains("audio-option-menu__pop-menu--checked"),ariaLabel:n.getAttribute("aria-label")}),n=n.nextElementSibling;return{status:"success",microphoneItems:t,hasSelectedMicrophone:t.some((e=>e.selected)),sokujiMicPresent:t.some((e=>e.text.includes("Sokuji Virtual Microphone")))}},showAudioProfileNotification:()=>{i()},resetAudioProfileNotificationDismissal:()=>{try{return localStorage.removeItem("sokuji-zoom-audio-profile-dismissed"),{success:!0,message:"Audio profile notification dismissal reset"}}catch(e){return{success:!1,error:e.message}}}}}else console.info("[Sokuji] [Zoom] Not in webclient iframe, exiting")})();